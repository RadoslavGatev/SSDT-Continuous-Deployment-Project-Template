SET NOCOUNT ON

DECLARE @mergeOutput TABLE ( [DMLAction] VARCHAR(6) );
MERGE INTO [Sales].[CountryRegionCurrency] AS [Target]
USING (VALUES
  (N'AE',N'AED','2014-02-08T10:17:21.510')
 ,(N'AR',N'ARS','2014-02-08T10:17:21.510')
 ,(N'AT',N'ATS','2014-02-08T10:17:21.510')
 ,(N'AT',N'EUR','2008-04-30T00:00:00')
 ,(N'AU',N'AUD','2014-02-08T10:17:21.510')
 ,(N'BB',N'BBD','2014-02-08T10:17:21.510')
 ,(N'BD',N'BDT','2014-02-08T10:17:21.510')
 ,(N'BE',N'BEF','2014-02-08T10:17:21.510')
 ,(N'BE',N'EUR','2008-04-30T00:00:00')
 ,(N'BG',N'BGN','2014-02-08T10:17:21.510')
 ,(N'BH',N'BHD','2014-02-08T10:17:21.510')
 ,(N'BN',N'BND','2014-02-08T10:17:21.510')
 ,(N'BO',N'BOB','2014-02-08T10:17:21.510')
 ,(N'BR',N'BRL','2014-02-08T10:17:21.510')
 ,(N'BS',N'BSD','2014-02-08T10:17:21.510')
 ,(N'BT',N'BTN','2014-02-08T10:17:21.510')
 ,(N'CA',N'CAD','2014-02-08T10:17:21.510')
 ,(N'CH',N'CHF','2014-02-08T10:17:21.510')
 ,(N'CL',N'CLP','2014-02-08T10:17:21.510')
 ,(N'CN',N'CNY','2014-02-08T10:17:21.510')
 ,(N'CO',N'COP','2014-02-08T10:17:21.510')
 ,(N'CR',N'CRC','2014-02-08T10:17:21.510')
 ,(N'CY',N'CYP','2014-02-08T10:17:21.510')
 ,(N'CZ',N'CZK','2014-02-08T10:17:21.510')
 ,(N'DE',N'DEM','2014-02-08T10:17:21.510')
 ,(N'DE',N'EUR','2014-02-08T10:17:21.510')
 ,(N'DK',N'DKK','2014-02-08T10:17:21.510')
 ,(N'DO',N'DOP','2014-02-08T10:17:21.510')
 ,(N'DZ',N'DZD','2014-02-08T10:17:21.510')
 ,(N'EC',N'USD','2014-02-08T10:17:21.510')
 ,(N'EE',N'EEK','2014-02-08T10:17:21.510')
 ,(N'EG',N'EGP','2014-02-08T10:17:21.510')
 ,(N'ES',N'ESP','2014-02-08T10:17:21.510')
 ,(N'ES',N'EUR','2008-04-30T00:00:00')
 ,(N'FI',N'EUR','2008-04-30T00:00:00')
 ,(N'FI',N'FIM','2014-02-08T10:17:21.510')
 ,(N'FJ',N'FJD','2014-02-08T10:17:21.510')
 ,(N'FR',N'EUR','2014-02-08T10:17:21.510')
 ,(N'FR',N'FRF','2014-02-08T10:17:21.510')
 ,(N'GB',N'GBP','2014-02-08T10:17:21.510')
 ,(N'GH',N'GHC','2014-02-08T10:17:21.510')
 ,(N'GR',N'EUR','2008-04-30T00:00:00')
 ,(N'GR',N'GRD','2014-02-08T10:17:21.510')
 ,(N'GT',N'GTQ','2014-02-08T10:17:21.510')
 ,(N'HK',N'HKD','2014-02-08T10:17:21.510')
 ,(N'HR',N'HRK','2014-02-08T10:17:21.510')
 ,(N'HU',N'HUF','2014-02-08T10:17:21.510')
 ,(N'ID',N'IDR','2014-02-08T10:17:21.510')
 ,(N'IE',N'EUR','2008-04-30T00:00:00')
 ,(N'IE',N'IEP','2014-02-08T10:17:21.510')
 ,(N'IL',N'ILS','2014-02-08T10:17:21.510')
 ,(N'IN',N'INR','2014-02-08T10:17:21.510')
 ,(N'IS',N'ISK','2014-02-08T10:17:21.510')
 ,(N'IT',N'EUR','2008-04-30T00:00:00')
 ,(N'IT',N'ITL','2014-02-08T10:17:21.510')
 ,(N'JM',N'JMD','2014-02-08T10:17:21.510')
 ,(N'JO',N'JOD','2014-02-08T10:17:21.510')
 ,(N'JP',N'JPY','2014-02-08T10:17:21.510')
 ,(N'KE',N'KES','2014-02-08T10:17:21.510')
 ,(N'KR',N'KRW','2014-02-08T10:17:21.510')
 ,(N'KW',N'KWD','2014-02-08T10:17:21.510')
 ,(N'LB',N'LBP','2014-02-08T10:17:21.510')
 ,(N'LK',N'LKR','2014-02-08T10:17:21.510')
 ,(N'LT',N'LTL','2014-02-08T10:17:21.510')
 ,(N'LU',N'EUR','2008-04-30T00:00:00')
 ,(N'LV',N'LVL','2014-02-08T10:17:21.510')
 ,(N'MA',N'MAD','2014-02-08T10:17:21.510')
 ,(N'MT',N'MTL','2014-02-08T10:17:21.510')
 ,(N'MU',N'MUR','2014-02-08T10:17:21.510')
 ,(N'MV',N'MVR','2014-02-08T10:17:21.510')
 ,(N'MX',N'MXN','2014-02-08T10:17:21.510')
 ,(N'MY',N'MYR','2014-02-08T10:17:21.510')
 ,(N'NA',N'NAD','2014-02-08T10:17:21.510')
 ,(N'NG',N'NGN','2014-02-08T10:17:21.510')
 ,(N'NL',N'EUR','2008-04-30T00:00:00')
 ,(N'NL',N'NLG','2014-02-08T10:17:21.510')
 ,(N'NO',N'NOK','2014-02-08T10:17:21.510')
 ,(N'NP',N'NPR','2014-02-08T10:17:21.510')
 ,(N'NZ',N'NZD','2014-02-08T10:17:21.510')
 ,(N'OM',N'OMR','2014-02-08T10:17:21.510')
 ,(N'PA',N'PAB','2014-02-08T10:17:21.510')
 ,(N'PE',N'PEN','2014-02-08T10:17:21.510')
 ,(N'PH',N'PHP','2014-02-08T10:17:21.510')
 ,(N'PK',N'PKR','2014-02-08T10:17:21.510')
 ,(N'PL',N'PLN','2014-02-08T10:17:21.510')
 ,(N'PL',N'PLZ','2014-02-08T10:17:21.510')
 ,(N'PT',N'EUR','2008-04-30T00:00:00')
 ,(N'PT',N'PTE','2014-02-08T10:17:21.510')
 ,(N'PY',N'PYG','2014-02-08T10:17:21.510')
 ,(N'RO',N'ROL','2014-02-08T10:17:21.510')
 ,(N'RU',N'RUB','2014-02-08T10:17:21.510')
 ,(N'RU',N'RUR','2014-02-08T10:17:21.510')
 ,(N'SA',N'SAR','2014-02-08T10:17:21.510')
 ,(N'SE',N'SEK','2014-02-08T10:17:21.510')
 ,(N'SG',N'SGD','2014-02-08T10:17:21.510')
 ,(N'SI',N'SIT','2014-02-08T10:17:21.510')
 ,(N'SK',N'SKK','2014-02-08T10:17:21.510')
 ,(N'SV',N'SVC','2014-02-08T10:17:21.510')
 ,(N'TH',N'THB','2014-02-08T10:17:21.510')
 ,(N'TN',N'TND','2014-02-08T10:17:21.510')
 ,(N'TR',N'TRL','2014-02-08T10:17:21.510')
 ,(N'TT',N'TTD','2014-02-08T10:17:21.510')
 ,(N'TW',N'TWD','2014-02-08T10:17:21.510')
 ,(N'US',N'USD','2014-02-08T10:17:21.510')
 ,(N'UY',N'UYU','2014-02-08T10:17:21.510')
 ,(N'VE',N'VEB','2014-02-08T10:17:21.510')
 ,(N'VN',N'VND','2014-02-08T10:17:21.510')
 ,(N'ZA',N'ZAR','2014-02-08T10:17:21.510')
 ,(N'ZW',N'ZWD','2014-02-08T10:17:21.510')
) AS [Source] ([CountryRegionCode],[CurrencyCode],[ModifiedDate])
ON ([Target].[CountryRegionCode] = [Source].[CountryRegionCode] AND [Target].[CurrencyCode] = [Source].[CurrencyCode])
WHEN MATCHED AND (
	NULLIF([Source].[ModifiedDate], [Target].[ModifiedDate]) IS NOT NULL OR NULLIF([Target].[ModifiedDate], [Source].[ModifiedDate]) IS NOT NULL) THEN
 UPDATE SET
  [Target].[ModifiedDate] = [Source].[ModifiedDate]
WHEN NOT MATCHED BY TARGET THEN
 INSERT([CountryRegionCode],[CurrencyCode],[ModifiedDate])
 VALUES([Source].[CountryRegionCode],[Source].[CurrencyCode],[Source].[ModifiedDate])
WHEN NOT MATCHED BY SOURCE THEN 
 DELETE
OUTPUT $action INTO @mergeOutput;

DECLARE @mergeError int
 , @mergeCount int, @mergeCountIns int, @mergeCountUpd int, @mergeCountDel int
SELECT @mergeError = @@ERROR
SELECT @mergeCount = COUNT(1), @mergeCountIns = SUM(IIF([DMLAction] = 'INSERT', 1, 0)), @mergeCountUpd = SUM(IIF([DMLAction] = 'UPDATE', 1, 0)), @mergeCountDel = SUM (IIF([DMLAction] = 'DELETE', 1, 0)) FROM @mergeOutput
IF @mergeError != 0
 BEGIN
 PRINT 'ERROR OCCURRED IN MERGE FOR [Sales].[CountryRegionCurrency]. Rows affected: ' + CAST(@mergeCount AS VARCHAR(100)); -- SQL should always return zero rows affected
 END
ELSE
 BEGIN
 PRINT '[Sales].[CountryRegionCurrency] rows affected by MERGE: ' + CAST(COALESCE(@mergeCount,0) AS VARCHAR(100)) + ' (Inserted: ' + CAST(COALESCE(@mergeCountIns,0) AS VARCHAR(100)) + '; Updated: ' + CAST(COALESCE(@mergeCountUpd,0) AS VARCHAR(100)) + '; Deleted: ' + CAST(COALESCE(@mergeCountDel,0) AS VARCHAR(100)) + ')' ;
 END
GO


SET NOCOUNT OFF
GO